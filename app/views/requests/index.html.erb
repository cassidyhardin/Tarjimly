<%= stylesheet_link_tag "application", media: "all", "data-turbolinks-track" => true %>
<%= javascript_include_tag "application", "data-turbolinks-track" => true %>
<%= csrf_meta_tags %>


<div class="flex-container pad-for-nav">
    <div class="flex-sidebar">
      <div class="profile-container">
        <h3> <%=@name%> </h3>
        <h4 class="bold-2"> <%=@role%> </h4>
        <h4> Total Requests: <span class="badgey"><%= @total_count %></span> </h4>
        <%=link_to "Sign Out", :controller => "auth", :action => :logout, method: :get, class: "btn btn-primary" %>

      </div>
      
      <h3 class="section-header pad-left mg-bt-10"> Notifications </h3>
      <div class="notifications-container">
          <% flash.each do |key, value| %>
          <% if key != 'alert'%>
              <div class="alert alert-<%= key %> alert-dismissible" role="alert">
                <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <%= value %>
              </div>
            <%end%>

          <% end %>
          <% if flash.nil? || flash.empty? %>
            <div class="alert alert-warning" role="alert">
              You have no new notifications.
            </div>
          <% end %>
      </div>

    </div>
    <div class="flex-body">
      <div class="spread mg-10" >
        <h3 class="section-header-big">
          <% if @status.is_a?(String) && @status.to_i == 0%>
            Pending Requests
          <% elsif @status.is_a?(String) && @status.to_i == 1%>
            Completed Requests
          <% else %>
            Your Requests
          <% end %>
        </h3>
        <div class="flex">
          <%= button_to "New Request", new_request_path, action: "new", method: :get, id: "new_request_button", class:"btn btn-primary", style:"margin-right: 10px "%>
          <label class="dropdown">
            <div class="dd-button">
              Filter
            </div>
            <input type="checkbox" class="dd-input" id="test">

            <ul class="dd-menu">
              <li><%= link_to "All Requests", requests_path() %></li>
              <li><%= link_to "Pending Requests", requests_path(status: 0) %></li>
              <li><%= link_to "Completed Requests", requests_path(status: 1) %></li>
            </ul>
          </label>
        </div>
      </div>

      <div class="request-list">
      <% if @requests.empty? %>
        <%if @status.is_a?(String) && @status.to_i == 1 %>
          <div class="alert alert-warning mg-tp-20" role="alert">
            You have no completed requests at the moment, please check back later! 
          </div>
        <%else%>
          <div class="alert alert-warning mg-tp-20" role="alert">
            You have no pending requests at the moment, get started by making a <a href="/requests/new" class="alert-link">new request</a>!
        <%end%>
      <% end %>
      <% @requests.each do |request| %>
          <div class="requests-card mg-top-15" id="request_<%=request.id%>">
            <div class="spread">
              <h4 class="card-title">
                <%= request.title %>
              </h4>
              <p class="lead-no-margin card-subs pad-top-5">
                <% if request._status.to_i != 1%>
                  <span class="blue">Deadline: </span> <span> <%= getDaysLeft(request)[0] %> </span>
                <% end%>
              </p>
            </div>
            <p class="langs card-subs"> 
                <%= request.from_language %>
                <i class="fa fa-arrow-right sm"></i>
                <%=request.to_language %>
            </p>
            <p class="card-text">
              <%= request.description %><br />
            </p>
            <div class="card-row">
              <div class="">
                <div class="tags-container">
                  <% if request.categories%>
                    <% request.categories.each do |c| %>
                      <span class="tag tag-blue"><%= "#{c}" %></span>
                    <% end %>
                  <%end%>
                  <% if request._status==0%>
                      <span class="tag tag-orange"> Pending</span>
                    <% elsif request._status==1 %>
                      <span class="tag tag-green"> Completed</span>
                    <% end %>
                </div>
              </div>
              <div class="card-col-2">
                <%= button_to "View", request_path(request_id: request.id), action: "show", method: :get, class:"btn btn-primary", style: "margin: 5px 0 0 0" %>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>
